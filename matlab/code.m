delay_us = 0:2:250;

% ADC data
adc = [ ...
  1817,1111,1122,1143,1209,1235,1301,1347,1401,1415, ...
  1467,1477,1507,1526,1584,1584,1616,1701,1691,1728, ...
  1773,1754,1833,1855,1876,1843,1888,1900,1908,1923, ...
  1938,1943,1955,1925,1935,1961,1883,1943,1937,1955, ...
  1937,1931,1920,1929,1931,1932,1920,1925,1920,1917, ...
  1907,1915,1931,1892,1904,1907,1897,1907,1903,1899, ...
  1899,1904,1890,1885,1885,1885,1884,1891,1894,1878, ...
  1891,1875,1874,1882,1881,1874,1867,1883,1877,1873, ...
  1879,1871,1886,1876,1872,1872,1872,1886,1871,1927, ...
  1884,1869,1872,1868,1871,1879,1861,1867,1860,1873, ...
  1862,1878,1872,1866,1871,1869,1809,1869,1823,1867, ...
  1865,1865,1846,1861,1861,1853,1875,1867,1850,1860, ...
  1869,1876,1872,1869,1846,1818 ];

t = delay_us(2:end);
y = adc(2:end);

model = @(b,t) b(1) * (1 - exp(-t / b(2))) + b(3);

% Find Fits
cost = @(b) sum((model(b,t) - y).^2);

% Initial guess
b0 = [800, 80, 1100];

% Minimize
b = fminsearch(cost, b0);

A   = b(1);
tau = b(2);
C   = b(3);

% Create Fit Curve
t_fit = linspace(0, 250, 500);
y_fit = model(b, t_fit);

% Generate it
figure;
plot(delay_us, adc, 'o', 'MarkerSize', 4); hold on;
plot(t_fit, y_fit, 'LineWidth', 2);
grid on;

xlabel('Delay (\mus)');
ylabel('ADC Value');
title(sprintf('Exponential Best Fit (\\tau = %.1f \\mus)', tau));
legend('Measured Data', 'Exponential Fit', 'Location', 'best');


